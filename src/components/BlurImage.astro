---
import { Image, getImage } from "astro:assets";
import type { ImageMetadata } from "astro";

interface Props {
  src: ImageMetadata;
  alt: string;
  class?: string;
  imgClass?: string;
  widths?: number[];
  sizes?: string;
}

const {
  src,
  alt,
  class: className,
  imgClass,
  widths = [400, 800, 1200],
  sizes = "(max-width: 640px) 100vw, (max-width: 1024px) 80vw, 1200px",
} = Astro.props;

const placeholder = await getImage({ src, width: 32, quality: 20, format: "webp" });
---

<div
  class:list={["overflow-hidden", className]}
  style={`background-image:url(${placeholder.src});background-size:cover;background-position:center`}
>
  <Image
    src={src}
    alt={alt}
    format="webp"
    quality={90}
    widths={widths}
    sizes={sizes}
    loading="lazy"
    decoding="async"
    class:list={[imgClass]}
    style="opacity:0;transition:opacity .3s ease"
    onload="this.style.opacity='1';this.parentElement.style.backgroundImage='none'"
  />
</div>
