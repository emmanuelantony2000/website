---
import Base from "../../layouts/Base.astro";
import BlogCard from "../../components/BlogCard.astro";
import { getCollection } from "astro:content";

const posts = await getCollection("blog");

// Sort by date descending (newest first)
posts.sort((a, b) => {
  const da = a.data.date ? new Date(a.data.date).getTime() : 0;
  const db = b.data.date ? new Date(b.data.date).getTime() : 0;
  return db - da;
});
---

<Base title="Emmanuel Antony | Blog" description="Thoughts on systems engineering, tooling, and writing.">
  {posts.length === 0 ? (
    <p class="text-muted-foreground text-center py-12">No posts yet.</p>
  ) : (
    <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
      {posts.map((post, index) => {
        const slug = post.id.replace(/\/index$/, "").replace(/\//g, "/");

        return (
          <BlogCard
            title={post.data.title}
            description={post.data.description}
            url={`/blog/${slug}`}
            tags={post.data.tags}
            cover={post.data.image?.src}
            coverAlt={post.data.image?.alt}
            featured={index === 0}
          />
        );
      })}
    </div>
  )}
</Base>
